# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://help.github.com/actions/language-and-framework-guides/publishing-nodejs-packages

name: Publish Package

on:
  workflow_run:
    workflows: ['Bump Version']
    branches: [main, version_alpha]
    types:
      - completed

permissions:
  contents: read
  packages: write

jobs:
  build-and-publish:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    uses: ClearTax/reusable-workflows/.github/workflows/publish-js-package.yml@main
    with:
      branch: ${{ github.event.workflow_run.head_branch }}
      node-version: '18.20.4'
    secrets:
      token: ${{ secrets.CLEARCI_TOKEN}}
      github-token: ${{ secrets.CLEARCI_AUTH_TOKEN }}
